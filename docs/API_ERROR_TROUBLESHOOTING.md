# APIエラー トラブルシューティングガイド

**作成日**: 2026年1月30日

---

## 問題の症状

フロントエンドで「データの取得に失敗しました」というエラーが表示される

---

## よくある原因と解決方法

### 原因1: バックエンドが起動していない

**症状:**
- エラーメッセージ: 「バックエンドサーバーに接続できません」
- ブラウザのコンソールに `ECONNREFUSED` エラー

**解決方法:**

1. **バックエンドを起動**
   ```cmd
   start-backend.bat
   ```

2. **バックエンドが正常に起動しているか確認**
   - `http://localhost:8000/health` にアクセス
   - `http://localhost:8000/docs` にアクセスしてSwagger UIが表示されるか確認

3. **ポート8000が使用されているか確認**
   ```cmd
   netstat -ano | findstr :8000
   ```

---

### 原因2: CORSエラー

**症状:**
- ブラウザのコンソールにCORS関連のエラー
- `Access-Control-Allow-Origin` エラー

**解決方法:**

1. **バックエンドのCORS設定を確認**
   - `backend/main.py` の `CORS_ORIGINS` 設定を確認
   - `http://localhost:3000` が含まれているか確認

2. **バックエンドを再起動**

---

### 原因3: 認証トークンの問題

**症状:**
- 401 Unauthorized エラー
- ログインページにリダイレクトされる

**解決方法:**

1. **再度ログイン**
   - フロントエンドでログアウトしてから再度ログイン
   - ユーザー名: `kaho0525`
   - パスワード: `kaho052514`

2. **トークンの確認**
   - ブラウザの開発者ツール → Application → Local Storage
   - `access_token` が存在するか確認

---

### 原因4: APIエンドポイントのパスが間違っている

**症状:**
- 404 Not Found エラー
- 「APIエンドポイントが見つかりません」というメッセージ

**解決方法:**

1. **バックエンドのAPIエンドポイントを確認**
   ```cmd
   # Swagger UIで確認
   http://localhost:8000/docs
   ```

2. **フロントエンドのAPIパスを確認**
   - `frontend/src/api/*.ts` ファイルのパスを確認
   - バックエンドのルーターの `prefix` と一致しているか確認

---

### 原因5: 権限不足

**症状:**
- 403 Forbidden エラー
- 「アクセス権限がありません」というメッセージ

**解決方法:**

1. **ユーザーの権限を確認**
   - 管理者アカウント（`kaho0525`）でログインしているか確認
   - バックエンドの `require_permission` や `require_role` デコレータを確認

---

## デバッグ方法

### ステップ1: ブラウザのコンソールを確認

1. ブラウザの開発者ツールを開く（F12）
2. Consoleタブを確認
3. NetworkタブでAPIリクエストを確認

### ステップ2: バックエンドのログを確認

バックエンドのコンソール出力を確認：
- リクエストが届いているか
- エラーが発生しているか
- ステータスコードは何か

### ステップ3: APIエンドポイントを直接テスト

Swagger UI (`http://localhost:8000/docs`) でAPIエンドポイントを直接テスト：
- 認証トークンを設定
- リクエストを送信
- レスポンスを確認

---

## 確認チェックリスト

- [ ] バックエンドが起動している (`http://localhost:8000/health`)
- [ ] フロントエンドが起動している (`http://localhost:3000`)
- [ ] ログインしている（トークンが存在する）
- [ ] CORS設定が正しい
- [ ] APIエンドポイントのパスが正しい
- [ ] ユーザーに適切な権限がある

---

## エラーメッセージの改善

フロントエンドのエラーハンドリングを改善しました：

- ネットワークエラー: 「バックエンドサーバーに接続できません」
- 404エラー: 「APIエンドポイントが見つかりません」
- 403エラー: 「アクセス権限がありません」
- 500エラー: 「サーバーエラーが発生しました」

ブラウザのコンソールにも詳細なエラー情報が出力されます。

---

以上
