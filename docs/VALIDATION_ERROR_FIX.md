# 422バリデーションエラー対処ガイド

**作成日**: 2026年1月30日

---

## 問題の症状

APIリクエストが422エラー（Unprocessable Entity）で失敗する

エラーメッセージ: 「ステータスコード422でリクエストが失敗しました」

---

## 原因

422エラーは**バリデーションエラー**です。リクエストの形式は正しいが、以下の理由で処理できません：

1. **必須フィールドが不足**
2. **フィールドの型が間違っている**
3. **フィールドの値が制約に違反している**
4. **フィールドの形式が正しくない**（例: メールアドレス形式、日付形式など）

---

## バックエンドのエラーレスポンス形式

FastAPIのバリデーションエラーは以下の形式で返されます：

```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Validation failed",
    "errors": [
      {
        "field": "field_name",
        "message": "error message",
        "type": "error_type"
      }
    ],
    "path": "/api/v1/...",
    "timestamp": "2026-01-30T..."
  }
}
```

---

## 修正内容

フロントエンドのエラーハンドリングを改善しました：

1. **422エラーの詳細を表示**
   - `errors`配列から各フィールドのエラーメッセージを抽出
   - フィールド名とエラーメッセージを表示

2. **エラーメッセージの改善**
   - 「バリデーションエラー: field_name: error message」の形式で表示
   - 複数のエラーがある場合は、カンマ区切りで表示

---

## デバッグ方法

### ステップ1: ブラウザのコンソールを確認

1. ブラウザの開発者ツールを開く（F12）
2. Consoleタブでエラーの詳細を確認
3. NetworkタブでAPIリクエストの詳細を確認

### ステップ2: レスポンスボディを確認

Networkタブで：
1. 失敗したリクエストをクリック
2. Responseタブでエラーの詳細を確認
3. `errors`配列の内容を確認

### ステップ3: Swagger UIで確認

1. `http://localhost:8000/docs` にアクセス
2. 該当するAPIエンドポイントを開く
3. "Try it out"をクリック
4. リクエストパラメータを確認
5. 必須フィールドがすべて入力されているか確認

---

## よくあるバリデーションエラー

### エラー1: 必須フィールドが不足

**症状:**
```json
{
  "field": "username",
  "message": "field required",
  "type": "value_error.missing"
}
```

**解決方法:**
- 必須フィールドをすべて入力する

### エラー2: フィールドの型が間違っている

**症状:**
```json
{
  "field": "age",
  "message": "value is not a valid integer",
  "type": "type_error.integer"
}
```

**解決方法:**
- 正しい型の値を入力する（数値フィールドには数値を入力）

### エラー3: フィールドの値が制約に違反

**症状:**
```json
{
  "field": "email",
  "message": "value is not a valid email address",
  "type": "value_error.email"
}
```

**解決方法:**
- 正しい形式の値を入力する（メールアドレス形式など）

---

## 確認チェックリスト

- [ ] 必須フィールドがすべて入力されている
- [ ] フィールドの型が正しい（文字列、数値、日付など）
- [ ] フィールドの値が制約を満たしている（最小値、最大値、正規表現など）
- [ ] リクエストボディの形式が正しい（JSON形式など）
- [ ] 認証トークンが正しく設定されている

---

## エラーメッセージの改善

フロントエンドのエラーハンドリングを改善しました：

- ✅ 422エラーの詳細を表示
- ✅ バリデーションエラーのフィールド名とメッセージを表示
- ✅ 複数のエラーがある場合は、すべて表示

これにより、どのフィールドに問題があるかすぐに分かります。

---

以上
