# UEP v5.0 監視強化チェックリスト

**作成日**: 2026年2月19日  
**目的**: 監視・オブザーバビリティの品質向上

---

## 1. Prometheus メトリクス

| 項目 | 内容 | 状態 |
|------|------|------|
| /metrics エンドポイント | メトリクスが取得できること | ✅ 既存済み |
| リクエスト数 | エンドポイント別のリクエスト数 | ✅ http_requests_total |
| レイテンシ | レスポンス時間のヒストグラム | ✅ http_request_duration_seconds |
| エラー率 | 5xx エラーの割合 | ✅ 計測可能（現状5xxなし） |

---

## 2. アラート条件（例）

| アラート名 | 条件 | 重要度 |
|------------|------|--------|
| HighErrorRate | 5xx エラー率 > 5% | 高 |
| HighLatency | p99 レイテンシ > 1s | 高 |
| ServiceDown | ヘルスチェック失敗 | 高 |
| HighMemoryUsage | メモリ使用率 > 80% | 中 |

※ Prometheus Alertmanager の設定: `infrastructure/monitoring/alertmanager/alertmanager.yml`、`prometheus/alerts.yml` に追加済み

---

## 3. Grafana ダッシュボード

| 項目 | 内容 |
|------|------|
| 概要ダッシュボード | RPS、エラー率、レイテンシの概要 |
| API 別メトリクス | エンドポイント別のリクエスト数・レイテンシ |
| インフラメトリクス | CPU、メモリ、ディスク（Node Exporter 使用時） |

---

## 4. ログ

| 項目 | 内容 | 状態 |
|------|------|------|
| 構造化ログ | JSON 形式で出力 | ✅ JsonFormatter 実装済み |
| ログレベル | DEBUG/INFO/WARNING/ERROR の適切な設定 | ✅ |
| 機密情報のマスキング | パスワード・トークンをログに出力しない | ✅ _mask_sensitive 実装済み |

---

## 5. トレーシング（OpenTelemetry）

| 項目 | 内容 | 状態 |
|------|------|------|
| 分散トレーシング | リクエストのトレースID伝播 | 既存済み |
| Jaeger 等での可視化 | トレースの可視化 | 要確認 |

---

## 実施記録

| 実施日 | 項目 | 結果 | 備考 |
|--------|------|------|------|
| 2026/2/19 | /metrics 確認 | ✅ 正常 | localhost:8000/metrics で Prometheus 形式のメトリクス取得可能。http_requests_total、http_request_duration_seconds を確認 |
| 2026/2/12 | アラート設定 | ✅ 追加 | alerts.yml, alertmanager.yml 作成 |
| 2026/2/12 | 構造化ログ | ✅ 追加 | JsonFormatter, 機密情報マスキング |
| 2026/2/12 | Grafana ダッシュボード | ✅ 追加 | uep-overview.json |

---

以上
